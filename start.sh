#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –∑–∞–ø—É—Å–∫—É CRM Nice

echo "üöÄ –ó–∞–ø—É—Å–∫ CRM Nice..."
echo ""

# –ü–µ—Ä–µ—Ö—ñ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –ø—Ä–æ—î–∫—Ç—É
cd "$(dirname "$0")"

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —î venv
if [ ! -d "venv" ]; then
    echo "üì¶ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞..."
    python3 -m venv venv
    if [ $? -ne 0 ]; then
        echo "‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è venv!"
        exit 1
    fi
fi

# –ê–∫—Ç–∏–≤—É–≤–∞–Ω–Ω—è venv
echo "‚úÖ –ê–∫—Ç–∏–≤—É–≤–∞–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞..."
source venv/bin/activate

if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó venv!"
    exit 1
fi

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è pip
echo "üì• –û–Ω–æ–≤–ª–µ–Ω–Ω—è pip..."
pip install --upgrade pip --quiet

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Django
echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Django..."
pip install django --quiet

if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Django!"
    exit 1
fi

# –í–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π
echo "üóÑÔ∏è  –í–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π..."
python manage.py migrate --noinput

if [ $? -ne 0 ]; then
    echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π!"
    exit 1
fi

echo ""
echo "‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤–æ! –ó–∞–ø—É—Å–∫–∞—é —Å–µ—Ä–≤–µ—Ä..."
echo "üåê –í—ñ–¥–∫—Ä–∏–π—Ç–µ http://127.0.0.1:8000/ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ"
echo ""
echo "–î–ª—è –∑—É–ø–∏–Ω–∫–∏ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Ctrl+C"
echo ""

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python manage.py runserver

