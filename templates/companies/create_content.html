{% load static %}

<!-- –¢—ñ–ª—å–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è HTMX (–±–µ–∑ layout) -->

<form class="card" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="form-grid">
        <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="form-column">
            <div class="form-group">
                <label class="form-group__label form-group__label--required">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                <input type="text" class="form-control" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" required>
            </div>

            <div class="form-group">
                <label class="form-group__label form-group__label--required">–¢–µ–ª–µ—Ñ–æ–Ω—ã + –ò–º–µ–Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</label>
                <div class="phone-inputs" id="phone-list">
                    <div class="phone-input-group">
                        <input type="tel" class="form-control" name="phones[]" placeholder="+380991234567" required>
                        <input type="text" class="form-control" name="contact_names[]" placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
                        <label class="phone-favorite">
                            <input type="radio" name="favorite_phone" value="0">
                            <span class="favorite-star">‚≠ê</span>
                        </label>
                    </div>
                </div>
                <button type="button" class="button button--sm button--secondary" data-action="add-phone">+ –î–æ–±–∞–≤–∏—Ç—å
                    —Ç–µ–ª–µ—Ñ–æ–Ω</button>
                <span class="form-hint">–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–º–µ—Ä–æ–≤, —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–æ –∑–≤–µ–∑–¥–æ–π</span>
            </div>

            <div class="form-group">
                <label class="form-group__label">
                    üí¨ Telegram
                </label>
                <input type="text" class="form-control" name="telegram"
                    placeholder="@username –∏–ª–∏ https://t.me/username">
            </div>

            <div class="form-group">
                <label class="form-group__label">–°–∞–π—Ç</label>
                <input type="url" class="form-control" name="website" placeholder="https://example.com">
                <span class="form-hint">–ë—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏</span>
            </div>

            <div class="form-group">
                <label class="form-group__label">Instagram</label>
                <input type="text" class="form-control" name="instagram" placeholder="@username">
                <span class="form-hint">–ë—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏</span>
            </div>

            <div class="form-group">
                <label class="form-group__label">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
                <textarea class="form-control" name="keywords" rows="3"
                    placeholder="CRM, Django, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥"></textarea>
                <span class="form-hint">–ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞</span>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="form-column">
            <div class="form-group">
                <label class="form-group__label form-group__label--required">–ì–æ—Ä–æ–¥</label>
                <select class="form-select" name="city" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    <option>–ö–∏–µ–≤</option>
                    <option>–•–∞—Ä—å–∫–æ–≤</option>
                    <option>–õ—å–≤–æ–≤</option>
                    <option>–û–¥–µ—Å—Å–∞</option>
                    <option>–î–Ω–µ–ø—Ä</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-group__label form-group__label--required">–†–∞–∑–¥–µ–ª</label>
                <select class="form-select" name="category" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</option>
                    <option>IT-—É—Å–ª—É–≥–∏</option>
                    <option>–†–µ—Å—Ç–æ—Ä–∞–Ω</option>
                    <option>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                    <option>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                    <option>–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-group__label form-group__label--required">–°—Ç–∞—Ç—É—Å</label>
                <select class="form-select" name="status" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
                    <option>–•–æ—Ä–æ—à–∏–π</option>
                    <option>–†–∞–±–æ—Ç–∞–µ–º</option>
                    <option>–ù–µ –¥–æ–∑–≤–æ–Ω</option>
                    <option>–ù–µ –Ω—É–∂–Ω–æ</option>
                    <option>–ü–æ–∑–∂–µ</option>
                    <option>–ü–æ–∑–≤–æ–Ω–∏—Ç—å</option>
                    <option>–ì–æ—Ä—è—á–∏–π</option>
                    <option>–•–æ–ª–æ–¥–Ω—ã–π</option>
                    <option>–¢–µ–ø–ª—ã–π</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-group__label">–î–∞—Ç–∞ –∑–≤–æ–Ω–∫–∞</label>
                <input type="date" class="form-control" name="call_date">
                <span class="form-hint">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –∑–≤–æ–Ω–∫–∞</span>
            </div>

            <div class="form-group">
                <label class="form-group__label">–ö—Ä–∞—Ç–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                <textarea class="form-control" name="short_comment" rows="3" maxlength="500"></textarea>
                <span class="form-hint">–ú–∞–∫—Å. 500 —Å–∏–º–≤–æ–ª–æ–≤</span>
            </div>

            <div class="form-group">
                <label class="form-group__label">–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea class="form-control textarea-auto-resize" name="full_description" rows="3"
                    placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏, —Å—Å—ã–ª–∫–∏, –∏–∫–æ–Ω–∫–∏..."></textarea>
            </div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤ -->
    <div class="form-section">
        <div class="form-group">
            <label class="form-group__label">–õ–æ–≥–æ—Ç–∏–ø</label>
            <input type="file" class="form-control" name="logo" accept="image/*">
            <div class="image-preview"></div>
        </div>

        <div class="form-group">
            <label class="form-group__label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</label>
            <input type="file" class="form-control" name="photos" accept="image/*" multiple>
            <div class="images-preview"></div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π -->
    <div class="form-actions">
        <button type="submit" class="button button--primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <a href="/companies/" hx-get="/companies/" hx-target="#main-content" hx-push-url="true"
            class="button button--secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
</form>

<script defer>
    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤
    document.querySelector('[data-action="add-phone"]').addEventListener('click', function () {
        const phoneList = document.getElementById('phone-list');
        const index = phoneList.children.length;
        const html = `
            <div class="phone-input-group">
                <input type="tel" class="form-control" name="phones[]" placeholder="+380991234567">
                <input type="text" class="form-control" name="contact_names[]" placeholder="–Ü–º'—è –∫–æ–Ω—Ç–∞–∫—Ç—É">
                <label class="phone-favorite">
                    <input type="radio" name="favorite_phone" value="${index}">
                    <span class="favorite-star">‚≠ê</span>
                </label>
                <button type="button" class="button button--sm button--danger remove-phone">‚àí</button>
            </div>
        `;
        phoneList.insertAdjacentHTML('beforeend', html);
    });

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
    document.addEventListener('click', function (e) {
        if (e.target.closest('.remove-phone')) {
            e.target.closest('.phone-input-group').remove();
        }
    });

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—É–±–ª—ñ–≤ (MOCK)
    const mockDuplicates = {
        phones: ['+380991111111', '+380992222222'],
        websites: ['https://existing.com'],
        instagrams: ['@existing'],
        telegrams: ['@existing_tg']
    };

    document.querySelectorAll('input[name="phones[]"]').forEach(input => {
        input.addEventListener('blur', function () {
            if (mockDuplicates.phones.includes(this.value)) {
                this.classList.add('input-error');
                const hint = document.createElement('span');
                hint.className = 'form-error';
                hint.textContent = '‚ö†Ô∏è –¢–∞–∫–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                this.parentElement.appendChild(hint);
            }
        });
    });

    document.querySelector('input[name="website"]').addEventListener('blur', function () {
        if (this.value && mockDuplicates.websites.includes(this.value)) {
            this.classList.add('input-error');
            const hint = document.createElement('span');
            hint.className = 'form-error';
            hint.textContent = '‚ö†Ô∏è –¢–∞–∫–æ–π —Å–∞–π—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
            this.parentElement.appendChild(hint);
        }
    });

    document.querySelector('input[name="instagram"]').addEventListener('blur', function () {
        if (this.value && mockDuplicates.instagrams.includes(this.value)) {
            this.classList.add('input-error');
            const hint = document.createElement('span');
            hint.className = 'form-error';
            hint.textContent = '‚ö†Ô∏è –¢–∞–∫–æ–π Instagram —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
            this.parentElement.appendChild(hint);
        }
    });

    document.querySelector('input[name="telegram"]').addEventListener('blur', function () {
        if (this.value && mockDuplicates.telegrams.includes(this.value)) {
            this.classList.add('input-error');
            const hint = document.createElement('span');
            hint.className = 'form-error';
            hint.textContent = '‚ö†Ô∏è –¢–∞–∫–æ–π Telegram —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
            this.parentElement.appendChild(hint);
        }
    });
</script>